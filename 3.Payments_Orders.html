<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Practice ‚Äì Payments & Orders</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f4f6f9;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        details {
            margin: 12px 0;
            background: #fff;
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        summary {
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            outline: none;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 8px;
        }

        code {
            font-family: Consolas, monospace;
        }

        .link-box {
            margin: 20px 0;
            background: #fff;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
        }

        .link-box a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .link-box a:hover {
            text-decoration: underline;
        }

        .schema-box {
            margin: 20px 0;
            background: #fff;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .schema-box img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1>MongoDB Practice ‚Äì Payments & Orders</h1>

    <div class="link-box">
        <p>
            üìå Create a project named <strong>Payments_Orders</strong>.
            The collections <em>Customers, Orders, Products, OrderDetails, Category, Suppliers, Shippers, Payments</em>
            are provided in the link below:
        </p>
        <p>
            üîó <a href="https://drive.google.com/file/d/1LXwTlBZS5DbDsWw6tCaddu6P9s7UZyRh/view?usp=drive_link"
                target="_blank">
                shopdb_Data Collection (Download Here)
            </a>
        </p>
    </div>

    <div class="schema-box">
        <p>üìä Below is the schema diagram for reference:</p>
        <a href="https://drive.google.com/file/d/1lk2JXYYIafLu-kw_M4I5lSP0LRSGMvjz/view?usp=sharing" target="_blank">
            <img src="./Payments_Orders_Scheme.png" alt="Database Schema">
        </a>
        <p>Click the image to view full size üîç</p>
    </div>


    <!-- Queries start here -->

    <details>
        <summary>1. Write Mongo query to retrieve the documents from the payments collection where payment status is
            either null or pending?</summary>
        <pre><code>db.payments.find({
  "paymentStatus": { $in: [null, "pending"] }
})</code></pre>
    </details>

    <details>
        <summary>2. Write Mongo query to find a buyer with the name John Smith and the email john@hotmail.com</summary>
        <pre><code>db.buyers.findOne({
  "name": "John Smith",
  "email": "john@hotmail.com"
});</code></pre>
    </details>

    <details>
        <summary>3. Find all Trips?</summary>
        <pre><code>db.Description.find({
  trip: { $exists: true }
})</code></pre>
    </details>

    <details>
        <summary>4. Write Mongo query to retrieve the documents from the payments collection without a payment date?
        </summary>
        <pre><code>db.payments.find({
  "payments_date": { $eq: null }
});</code></pre>
    </details>

    <details>
        <summary>5. Find all companies from the companies collection?</summary>
        <pre><code>db.companies.find({});</code></pre>
    </details>

    <details>
        <summary>6. Write Mongo query to find a product with a price greater than or equal to 1500?</summary>
        <pre><code>db.order_details.findOne({
  price: { $gte: 1500 }
});</code></pre>
    </details>

    <details>
        <summary>7. Write Mongo query to retrieve all the orders that shipped before 2022-05-26</summary>
        <pre><code>db.order.find({
  "ship_date": { $lt: "2022-05-26" }
});</code></pre>
    </details>

    <details>
        <summary>8. Print all details of orders whose Total Order Amount is greater than 5000?</summary>
        <pre><code>db.orders.find({
  "Total_order_amount": { $gt: 5000 }
});</code></pre>
    </details>

    <details>
        <summary>9. Write Mongo query to retrieve the documents from the payments collection with a non-null
            payment_date?</summary>
        <pre><code>db.payments.find({
  paymentDate: { $ne: null }
});</code></pre>
    </details>

    <details>
        <summary>10. Write Mongo query to find the total number of orders shipped?</summary>
        <pre><code>db.orders.aggregate([
  { $match: { "status": "shipped" } },
  { $count: "total_shipped_orders" }
]);</code></pre>
    </details>

    <details>
        <summary>11. Write Mongo query to find first order with customer ID 2 in orders collection?</summary>
        <pre><code>db.orders.findOne({
  "customer_id": 2
});</code></pre>
    </details>

    <details>
        <summary>12. Write Mongo query to retrieve the documents from the payments collection with their paymentMethod?
        </summary>
        <pre><code>db.payments.find(
  {},
  { "paymentMethod": 1, _id: 0 }
);</code></pre>
    </details>

    <details>
        <summary>13. Write Mongo query to retrieve the documents from the payments collection with a specific payment
            method UPI?</summary>
        <pre><code>db.payments.find({
  "paymentMethod": "UPI"
});</code></pre>
    </details>


    <details>
        <summary>14. Write Mongo query to retrieve the orders grouped by customer_id with the min total</summary>
        <pre><code>db.orders.aggregate([
  {
    $group: {
      _id: "$customer_id",
      minTotal: { $min: "$total" }
    }
  }
])</code></pre>
    </details>

    <details>
        <summary>15. Write Mongo query to get the total revenue from all orders</summary>
        <pre><code>db.orders.aggregate([
  {
    $group: {
      _id: null,
      total: { $sum: "$total" }
    }
  }
])</code></pre>
    </details>

    <details>
        <summary>16. Find the number of Customers per City & Country (sorted by City)</summary>
        <pre><code>db.customers.aggregate([
  { $group: { _id: { city: "$City", country: "$Country" }, numCustomers: { $sum: 1 } } },
  { $sort: { "_id.city": 1 } },
  { $project: { _id: 0, city: "$_id.city", country: "$_id.country", numCustomers: 1 } }
])</code></pre>
    </details>

    <details>
        <summary>17. Retrieve the payment of order _id:1 with paymentStatus</summary>
        <pre><code>db.orders.aggregate([
  { $match: { _id: 1 } },
  { $lookup: {
      from: "payments",
      localField: "_id",
      foreignField: "order_id",
      as: "paymentInfo"
  }},
  { $unwind: "$paymentInfo" },
  { $project: { _id: 0, paymentStatus: "$paymentInfo.status" } }
])</code></pre>
    </details>

    <details>
        <summary>18. Total number of suppliers in each city (descending)</summary>
        <pre><code>db.suppliers.aggregate([
  { $group: { _id: "$address.city", count: { $sum: 1 } } },
  { $sort: { count: -1 } }
])</code></pre>
    </details>

    <details>
        <summary>19. Find sum of Total order amount for each shipper (ascending)</summary>
        <pre><code>db.orders.aggregate([
  { $group: { _id: "$ShipperID", totalOrderAmount: { $sum: "$OrderAmount" } } },
  { $sort: { totalOrderAmount: 1 } }
])</code></pre>
    </details>

    <details>
        <summary>20. Find names and phone numbers of all shippers</summary>
        <pre><code>db.shippers.find({}, { name: 1, phone: 1, _id: 0 })</code></pre>
    </details>

    <details>
        <summary>21. Average total of orders made by customers in California (CA)</summary>
        <pre><code>db.orders.aggregate([
  { $match: { "address.state": "CA" } },
  { $group: { _id: null, avgTotal: { $avg: "$total" } } },
  { $project: { _id: 0, avgTotal: { $round: ["$avgTotal", 0] } } }
])</code></pre>
    </details>

    <details>
        <summary>22. Find total count of orders by status</summary>
        <pre><code>db.orders.aggregate([
  { $group: { _id: "$status", count: { $sum: 1 } } }
])</code></pre>
    </details>

    <details>
        <summary>23. Print all details of orders placed on 8th August 2021</summary>
        <pre><code>db.orders.find({ OrderDate: "2021-08-08" }).sort({ OrderID: -1 })</code></pre>
    </details>

    <details>
        <summary>24. Retrieve the shipper name for order with _id:1</summary>
        <pre><code>db.orders.aggregate([
  { $match: { _id: 1 } },
  { $lookup: {
      from: "shippers",
      localField: "shipper_id",
      foreignField: "_id",
      as: "shipperDetails"
  }},
  { $unwind: "$shipperDetails" },
  { $project: { _id: 0, shiperName: "$shipperDetails.name" } }
])</code></pre>
    </details>

    <details>
        <summary>25. Find all shipped orders</summary>
        <pre><code>db.orders.find({ status: "shipped" })</code></pre>
    </details>

    <details>
        <summary>26. Retrieve orders grouped by customer_id with total sum</summary>
        <pre><code>db.orders.aggregate([
  { $group: { _id: "$customer_id", total: { $sum: "$orderAmountField" } } }
])</code></pre>
    </details>

    <details>
        <summary>27. Retrieve all orders with their corresponding customer details</summary>
        <pre><code>db.orders.aggregate([
  { $lookup: {
      from: "customers",
      localField: "customer_id",
      foreignField: "_id",
      as: "customer_details"
  }}
])</code></pre>
    </details>

    <details>
        <summary>28. Find users with name and email who use Hotmail</summary>
        <pre><code>db.buyers.aggregate([
  { $match: { email: { $regex: "@hotmail\\.com$", $options: "i" } } },
  { $group: { _id: "$name", emails: { $push: "$email" } } }
])</code></pre>
    </details>

    <details>
        <summary>29. Retrieve documents from payments collection with non-null payment_date</summary>
        <pre><code>db.payments.find({ paymentDate: { $ne: null } })</code></pre>
    </details>

    <details>
        <summary>30. Find all customers</summary>
        <pre><code>db.customers.find()</code></pre>
    </details>

    <details>
        <summary>31. Find city with the longest name and its length</summary>
        <pre><code>db.customers.aggregate([
  { $group: { _id: "$City", nameLength: { $first: { $strLenCP: "$City" } } } },
  { $sort: { nameLength: -1 } },
  { $limit: 1 },
  { $project: { _id: 0, City: "$_id", nameLength: 1 } }
])</code></pre>
    </details>

    <details>
        <summary>32. Find number of orders placed by each customer (with name)</summary>
        <pre><code>db.orders.aggregate([
  { $group: { _id: "$customer_id", order_count: { $sum: 1 } } }
])</code></pre>
    </details>

    <details>
        <summary>33. Retrieve payments sorted by amount (descending)</summary>
        <pre><code>db.payments.find({}).sort({ amount: -1 })</code></pre>
    </details>

    <details>
        <summary>34. Retrieve payments with amount ‚â§ 30</summary>
        <pre><code>db.payments.find({ amount: { $lte: 30 } })</code></pre>
    </details>

    <details>
        <summary>35. Find names and email addresses of buyers from San Francisco</summary>
        <pre><code>db.buyers.find({ "address.city": "San Francisco" }, { name: 1, email: 1, _id: 0 })</code></pre>
    </details>

    <details>
        <summary>36. Find orders placed in April 2022</summary>
        <pre><code>db.orders.find({
  order_date: {
    $gte: ISODate("2022-04-01T00:00:00.000Z"),
    $lt: ISODate("2022-05-01T00:00:00.000Z")
  }
})</code></pre>
    </details>

    <details>
        <summary>37. Calculate average score for each grade category (restaurants)</summary>
        <pre><code>db.restaurants.aggregate([
  { $unwind: "$grades" },
  { $group: { _id: "$grades.grade", avgScore: { $avg: "$grades.score" } } }
])</code></pre>
    </details>

    <details>
        <summary>38. Retrieve buyers in California (CA), sorted by name desc, limit 3</summary>
        <pre><code>db.buyers.find({ "address.state": "CA" })
  .sort({ name: -1 })
  .limit(3)</code></pre>
    </details>


</body>

</html>